<!DOCTYPE html>
<html>
  <head>
    <title>Catalogo Search Page</title>
    <link rel="stylesheet" href="../assets/catalogo.css">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>

</head>
  <body class="container">
    <header id="pageHeader" class="masthead">
      <p><a href="/">The Cicognara Digital Library</a></p>
    </header>

    <div id="side">
      <h1>Catalogo Search</h1>
      <input id="search_input" name="search" placeholder="Search"></input><br />
      <button id="search_btn" onclick="doSearch();">Search</button>
    </div>
    <main id="main">
      <h1>Results</h1>
      <div id="search_results"></div>
    </main>

<script src="./data_full.js"></script>
<script>

  const options = {
      // isCaseSensitive: false,
      // includeScore: false,
      // shouldSort: true,
      // includeMatches: false,
      // findAllMatches: false,
      // minMatchCharLength: 1,
      // location: 0,
      // threshold: 0.6,
      // distance: 100,
      // useExtendedSearch: false,
      // ignoreLocation: false,
      // ignoreFieldNorm: false,
      // fieldNormWeight: 1,
      threshold: 0.3,
      keys: [
          "title",
          "creator",
          "description",
          "subject"
      ]
  };

  const fuse = new Fuse(data, options);

  function doSearch(event){
      const term = document.getElementById('search_input').value;
      document.getElementById('search_results').innerHTML = "";
      let results = fuse.search(term);
      //let results = fuse.search(term);
      let header = document.createElement('h1');
      header.innerText = "number found: " + results.length;
      document.getElementById('search_results').appendChild(header);
      let ul = document.createElement('ul');
      results.forEach(result => {
          console.log(result.item);

          let dl = document.createElement('dl');
          let dt = document.createElement('dt');
          let dd = document.createElement('dd');
          dt.innerText = "cicognaraNumber";
          dd.innerText = result.item.cicognaraNumber;
          dl.appendChild(dt);
          dl.appendChild(dd);

          dt = document.createElement('dt');
          dd = document.createElement('dd');
          dt.innerText = "dclNumber";
          dd.innerText = result.item.dclNumber;
          dl.appendChild(dt);
          dl.appendChild(dd);

          dt = document.createElement('dt');
          dd = document.createElement('dd');
          dt.innerText = "creator";
          dd.innerText = result.item.creator;
          dl.appendChild(dt);
          dl.appendChild(dd);

          dt = document.createElement('dt');
          dd = document.createElement('dd');
          dt.innerText = "title";
          dd.innerText = result.item.title;
          dl.appendChild(dt);
          dl.appendChild(dd);

          let li = document.createElement('li');
          //li.innerText = result.item.title;
          li.appendChild(dl);
          ul.appendChild(li);
      });
      document.getElementById('search_results').appendChild(ul);
  };


</script>
</body>
</html>
